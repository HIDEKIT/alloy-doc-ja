Alloy タスク
============

本文書は[Alloy Tasks](http://docs.appcelerator.com/titanium/latest/#!/guide/Alloy_Tasks)の日本語訳です。

* [はじめに](#はじめに)
* [Command-Line Interace](#command-line-interace)
    * [CLI のインストール](#cli-のインストール)
    * [開発版のインストール](#開発版のインストール)
    * [新しいアプリケーションを作成する](#新しいアプリケーションを作成する)
    * [コンポーネントを生成する](#コンポーネントを生成する)
        * [Controller を生成する](#controller-を生成する)
        * [View を生成する](#view-を生成する)
        * [Style を生成する](#style-を生成する)
        * [Model を生成する](#model-を生成する)
        * [Migration を生成する](#migration-を生成する)
        * [Widget を生成する](#widget-を生成する)
        * [alloy.jmk を生成する](#alloyjmk-を生成する)
    * [Application をコンパイルする](#application-をコンパイルする)
    * [Application を実行する](#application-を実行する)
    * [Special Project Components をインストールする](#special-project-components-をインストールする)
        * [Compiler Plugin をインストールする](#compiler-plugin-をインストールする)
* [Studio](#studio)
    * [Alloy Project を作成する](#alloy-project-を作成する)
    * [Controller を作成する](#controller-を作成する)
    * [Model を作成する](#model-を作成する)
    * [Migration を作成する](#migration-を作成する)
    * [Widget を作成する](#widget-を作成する)
    * [アプリケーションをビルドして実行する](#アプリケーションをビルドして実行する)
    * [Content Assistance を利用する](#content-assistance-を利用する)
    * [Alloy のコードをデバッグする](#alloy-のコードをデバッグする)


はじめに
--------

Alloy フレームワークは、プロジェクトを管理する方法を2通り用意しています。Alloy command-line interface (CLI) を使ってコンソールで Alloy コマンドを実行することも、 Titanium Stadio の GUI でそれらにアクセスすることもできます。

<!--
The Alloy framework provides two methods for managing your projects. You can either run Alloy commands from a console using the Alloy command-line interface (CLI), or access them through the Studio GUI.
-->

Command-Line Interace
---------------------

Alloy は新しいプロジェクトを作成したり、コンポーネントのひな形を生成したり、Alloy のコードを Titanium のコードにコンパイルするための CLI を提供しています。

```alloy --help``` を実行してオプションの一覧を確認するか、[Alloy Command-Line Interface Reference](http://docs.appcelerator.com/titanium/3.0/#!/guide/Alloy_Command-Line_Interface_Reference) を参照してください。

<!--
Alloy provides a command-line interface to create a new project, generate skeleton components, and compile Alloy code to Titanium code.

Run alloy --help to see all available target options or see the Alloy Command-Line Interface Reference.
-->

### CLI のインストール

最新の Alloy CLI のインストール方法については [CLI のインストール](Alloy_Quick_Start.md#cli-のインストール) を参照してく
ださい。

<!--
See Command-Line Interface Installation for directions on installing the latest released Alloy CLI.
-->

### 開発版のインストール

ここでは最新の開発版のインストール方法について説明します。

[Node.js](http://nodejs.org/) をインストールしてから、Alloy の github レポジトリを clone して、Alloy プロジェクトの root ディレクトリで npm install してください。

<!--
These directions install the latest development changes.

After installing Node.js, clone the Alloy github repository and perform an npm install from the Alloy project's root directory:
-->

```bash
git clone https://github.com/appcelerator/alloy.git
cd alloy
[sudo] npm install -g .
```

### 新しいアプリケーションを作成する

このコマンドは Mobile プロジェクトのひな形を作成してから、そのひな形の存在するディレクトリで実行するべきです。プロジェクトを実行するのに必要な一部ファイルは、 Alloy CLI では生成されません。

Alloy アプリケーションを作成するには、以下のコマンドをプロジェクトの root フォルダで実行します。

<!--
> This command should be ran from a directory containing a previously created skeleton Mobile project. Some files required to run the project are not generated by the Alloy CLI.

To create an Alloy application, run the following command from the root folder of the project:
-->

```bash
alloy new [path_to_project] [template_type]
```

2番めのパラーメータには、 Alloy プロジェクトの場所が root ディレクトリ出ない場合に、プロジェクトの場所を指定します。

3番目のパラメータには、利用するアプリケーションのテンプレートを指定します。現在サポートされているオプションは、1画面アプリケーション用の 'default' と、タブアプリケーション用の 'two_tabbed' です。

ALloy は、 Studio や CLI に、どのように Alloy コンパイラを使うかを教える特別なコンパイラプラグインをインストールします。

新しい Alloy プロジェクトは app という名前のフォルダを持ち、そこに Alloy アプリケーションのひな形が格納されています。

<!--
The second parameter specifies the location of the Alloy project if it is not the root directory.

The third parameter specifies the application template to use. The current options are 'default' for a single pane application or 'two_tabbed' for a tabbed application.

Alloy installs a special compiler plugin that helps Studio or the CLI know how to use the Alloy compiler.

A new Alloy project has a folder named app that contains the skeleton Alloy application.
-->

### コンポーネントを生成する

CLI をつかって Controller (View, Style と共に) や Model, Database Migration, Widget のひな形を生成することができます。以下のコマンドは、プロジェクトの root フォルダから実行するか、 -o のコマンドラインオプションでプロジェクトの場所を指定してください。--platform オプションを使って Platform 特有の View や Controller を作成することもできます。

<!--
The CLI can generate skeleton controllers (with views and styles), models, database migrations and widgets. The following commands can be ran from the root folder of the project or the location of the project may be specified with the -o command-line option. You can also create platform-specific views or controllers using the --platform option.
-->

#### Controller を生成する

Controller を Style や View と一緒に生成するには、以下のコマンドを実行してください。

<!--
To generate a controller with a style and view, run the following command:
-->

```bash
alloy generate controller <name> [-o path_to_project/app] [--platform <platform>]
```

app/controllers/<name>.js, app/styles/<name>.tss, app/views/<name>.xml が生成されます。

<!--
This creates app/controllers/<name>.js, app/styles/<name>.tss, and app/views/<name>.xml.
-->

#### View を生成する

View と Style を Controller なしで生成するには、以下のコマンドを実行してください。

<!--
To generate a view and style without a controller, run the following command:
-->

```bash
alloy generate view <name> [-o path_to_project/app] [--platform <platform>]
```

app/styles/<name>.tss と app/views/<name>.xml が生成されます。

#### Style を生成する

View, Controller 用に Style を生成するには、以下のコマンドを実行してください。

<!--
To generate a style for a view-controller, run the following command:
-->

```bash
alloy generate style <name>
```

Style ファイルのひな形を生成するのに、 Alloy は markup ファイルの中の id と属性の名前を利用します。app/styles/<name>.tss が生成されます。 

<!--
Alloy uses the id and attribute names in the markup file to populate the skeleton style file. This creates app/styles/<name>.tss.
-->

すべての View, Controller 用に Style を生成する場合は、以下のコマンドを実行してください。

<!--
To generate style files for all view-controllers, run the following command:
-->

```bash
alloy generate style --all
```

markup ファイルで新しい id やクラス属性を追加した場合は、これらのコマンドのいずれかを実行することで、新しい属性を使って Style ファイルを更新することができます。

<!--
If you add new id or class attributes to the markup file, running either of these commands updates the style file with the new attributes.
-->

#### Model を生成する

Model を生成するには、以下のコマンドを実行してください。

<!--
To generate a model, run the following command:
-->

```bash
alloy generate model <name> <adapter> [<col_name_1>:<col_type_1> <col_name_2>:<col_type_2> ...] [-o path_to_project/app]
```

4番目のパラメータには adapter タイプとして、HTML5 のローカルストレージ用の 'localStorage' (Mobile Web platform) か、 SQLite エンジン用の 'sql' (Andriod 及び iOS platform) か、 Titanium SDK のコンテキストのローカルにモデルを保存する 'properties' を指定します。

5番目のパラメータではテーブルスキーマを定義します。adapter タイプが 'sql' または 'properties' の場合に必須です。

このコマンドは app/models/<name>.js を作成し、adapter タイプが 'sql' の場合には app/migrations/DATETIME_<name>.js を作成します。

<!--
The fourth parameter selects the adapter type, either 'localStorage' for HTML5 localStorage (Mobile Web platform), 'sql' for SQLite engine (Android and iOS platforms), or 'properties' for storing models locally in Titanium SDK context.

The fifth parameter defines the table schema. This is required for 'sql' and 'properties' adapter types.

This creates app/models/<name>.js, and app/migrations/DATETIME_<name>.js if the adapter type is 'sql'.
-->

#### Migration を生成する

特定の Model に対してスタンドアローンの Migration を生成するには、以下のコマンドを実行してください。

<!--
To generate a standalone migration for a specific model, run the following command:
-->

```bash
alloy generate migration <name> [-o path_to_project/app]
```

このコマンドは、指定された Model 用にタイムスタンプ順に並んだ Migration ファイル (app/migrations/DATETIME_<name>.js) を作成します。

<!--
This creates a timestamp-ordered migration file for the model specified, that is, app/migrations/DATETIME_<name>.js
-->

#### Widget を生成する

標準の Widget を生成するには以下のコマンドを実行してください。

<!--
To generate a basic widget, run the following command:
-->

```bash
alloy generate widget <name> [-o path_to_project/app]
```

このコマンドは、プロジェクトの app/widgets パスに設定ファイル、 Controller, Style View (app/widgets/<name>/widget.json, app/widgets/<name>/controllers/widget.js, app/widgets/<name>/styles/widget.tss, and app/widgets/<name>/views/widget.xml) を生成して、デフォルトの Widget を作成します。この Widget は Alloy プロジェクトの設定ファイルである config.json の dependency へ自動的に追加されます。

<!--
This creates a default widget in the project's app/widgets path, generating a configuration file, controller, style and view: app/widgets/<name>/widget.json, app/widgets/<name>/controllers/widget.js, app/widgets/<name>/styles/widget.tss, and app/widgets/<name>/views/widget.xml. The widget is automatically added as a dependency in the Alloy project's configuration file config.json.
-->

#### alloy.jmk を生成する

ビルドをカスタマイズするための alloy.jmk ファイルを生成するには、以下のコマンドを実行します。

<!--
To generate the build customization file alloy.jmk, run the following command:
-->

```bash
alloy generate jmk [-o path_to_project/app]
```

このコマンドは JavaScript の Makefile である app/alloy.jmk を、いくつかの task hooks と共に作成します。詳細は [Build 設定ファイル (alloy.jmk)](Alloy_Reference_Guides/Build_Configuration_File.md) を参照してください。

<!--
This creates the JavaScript Makefile app/alloy.jmk with a few task hooks in place. Refer to Project Build Customization File for more details.
-->

### Application をコンパイルする

アプリケーションをビルドするには以下のコマンドを実行してください。

<!--
To build an application, run the following command:
-->

```bash
alloy compile [path_to_project] [-c compile_options]
```

プロジェクトのルートディレクトリでこのコマンドを実行すると、ファイルが自動的に正しい場所へコンパイルされます。追加のコンパイラ設定オプションは、 ```-c``` オプションで指定します。たとえば、 ```-c beautify=false,deploytype=test``` は出力する JavaScript の beautify 機能を無効化して、テスト環境用にアプリケーションをビルドします。

<!--
Running this from the root directory of the project compiles the files to the correct location automatically. Extra compiler configuration options can be specified with the -c option. For instance, using -c beautify=false,deploytype=test disables beautifying the output JavaScript files and build the application for a test environment.
-->

### Application を実行する

アプリケーションを動かすには、 Titanium CLI で titanium build コマンドを利用します。　

<!--
To run an application, use the titanium build command from the Titanium CLI:
-->

```bash
titanium build --platform <platform> [--project-dir <value>] [--sdk <value>] [ <platform_build_options> ]
```

利用可能なオプションの完全な説明は [Titanium Command-Line Interface Reference guide](http://docs.appcelerator.com/titanium/3.0/#!/guide/Titanium_Command-Line_Interface_Reference-section-35619828_TitaniumCommand-LineInterfaceReference-Build) を参照してください。

<!--
See the Titanium Command-Line Interface Reference guide for a complete explanation of the available options.
-->

### Special Project Components をインストールする

#### Compiler Plugin をインストールする

Alloy プロジェクトを Titanium Studio へ繋ぐコンパイラプラグインをインストールするには、以下のコマンドを実行してください。

<!--
To install the compiler plugin that hooks the Alloy project to Studio, run the following command:
-->

```bash
alloy install plugin [path_to_project]
```

プロジェクトが旧バージョンの Alloy で作成されていた場合は、このコマンドでコンパイラプラグインをアップデートしてください。

<!--
Use this command to update the compiler plugin if your project was created using an older version of Alloy.
-->

Studio
------

Alloy プロジェクトの作成や管理には Studio の 3.0.0 以上も使えます。

<!--
Studio 3.0.0 and later may also be used to create and manage Alloy projects.
-->

### Alloy Project を作成する

新しい Alloy プロジェクトを作成するには、 Studio を起動して、

1. メニューで **File > New > Mobile Project"" を選択。 New Mobile Project** のウィザードが表示されます。
2. **Available Templates** で **Alloy** プロジェクトを選択し、 **Next** ボタンをクリック。
3. すべてのフィールドを埋めて、 **Finish** ボタンをクリック

新しい Alloy プロジェクトのひな形が作成されます。Resources フォルダは App, Project Explorer で隠されているので注意してください。

<!--
To create a new Alloy project, start Studio, then

1. From the menu, select File > New > Mobile Project. The New Mobile Project wizard appears.
2. Select Alloy in the Available Templates box, then click the Next button.
3. Complete all of the fields, then click the Finish button.

A new skeleton Alloy project will be generated. Note that the Resources folder is hidden from the App and Project Explorer.
-->

### Controller を作成する

View, Style とともに新しい Controller を作成するには、

1. プロジェクトの App Explorer または Project Explorer で右クリック
2. **New > Alloy Controller** を選択。 **New Controller** ダイアログが表示されます。
3. **Controller name** というテキストボックスで Controller の名前を入力。重複した名前を設定すると警告が表示されます。
4. **OK** ボタンをクリック

これで ```app/controllers/<name>.js, app/styles/<name>.tss, app/views/<name>.xml``` が生成されます。

<!--
To create a new controller with a view and style,

1. Right-click on your project in the App or Project Explorer.
2. Select New > Alloy Controller. The New Controller dialog box appears.
3. In the Controller name textbox, enter the name of the controller. A warning appears if a duplicate exists.
4. Click the OK button.

This creates app/controllers/<name>.js, app/styles/<name>.tss, and app/views/<name>.xml.
-->

### Model を作成する

新しいモデルを作成するには、

1. プロジェクトの App Explorer または Project Explorer で右クリック
2. **New > Alloy Model** を選択。 **New Model** ダイアログが表示されます。
3. **Model name** というテキストボックスで Model の名前を入力。重複した名前を設定すると警告が表示されます。
4. **Adapter** のドロップダウンでストレージの種類を選択
   - SQL の場合、 **Schema** テーブル でデータベーススキーマの名前とデータタイプを入力してください。
5. **OK** ボタンをクリック

これで ```app/models/<name>.js``` が生成されます。

<!--
To create a new model,

1. Right-click on your project in the App or Project Explorer.
2. Select New > Alloy Model. The New Model dialog box appears.
3. In the Model name textbox, enter the name of the model. A warning appears if a duplicate exists.
4. In the Adapterdrop-down box, select the type of storage.
  - For sql, in the Schema table, enter the names and data types of the database schema.
5. Click the OK button.

This creates app/models/<name>.js.
-->

### Migration を作成する

特定のモデルに対して standalone migration を生成するには、

1. プロジェクトの App Explorer または Project Explorer で右クリック
2. **New > Alloy Migration** を選択。 **New Migration** ダイアログが表示されます。
3. **Migration name** というテキストボックスで、データベース migration ファイルを必要としている Model の名前を入力。
4. **OK** ボタンをクリック

これで、指定された Model 用の時間順に並んだ migration ファイル (```app/migrations/DATETIME_<name>.js```) が作成されます。

<!--
To generate a standalone migration for a specific model,

1. Right-click on your project in the App or Project Explorer.
2. Select New > Alloy Migration. The New Migration dialog box appears.
3. In the Migration name textbox, enter the name of the model that needs a database migration file.
4. Click the OK button.

This creates a timestamp-ordered migration file for the model specified, that is, app/migrations/DATETIME_<name>.js
-->

### Widget を作成する

Widget を作成するには、

1. プロジェクトの App Explorer または Project Explorer で右クリック
2. **New > Alloy Widget** を選択。 **New Widget** ダイアログが表示されます。
3. **Widget name** というテキストボックスで Widget の名前を入力。重複した名前を設定すると警告が表示されます。
4. **OK** ボタンをクリック

これでプロジェクトの ```app/widgets``` パスにデフォルトの Widget が作成され、 設定ファイル, Controller, Style, View: ```app/widgets/<name>/widget.json, app/widgets/<name>/controllers/widget.js, app/widgets/<name>/styles/widget.tss, app/widgets/<name>/views/widget.xml``` が作成されます。また、 Widget は Alloy プロジェクトの設定ファイル ```config.json``` の dependency に自動的に追加されます。

<!--
To create a basic widget,

1. Right-click on your project in the App or Project Explorer.
2. Select New > Alloy Widget. The New Widget dialog box appears.
3. In the Widget name textbox, enter the name of the migration. A warning appears if a duplicate exists.
4. Click the OK button.

This creates a default widget in the projects's app/widgets path, generating a configuration file, controller, style and view: app/widgets/<name>/widget.json, app/widgets/<name>/controllers/widget.js, app/widgets/<name>/styles/widget.tss, and app/widgets/<name>/views/widget.xml. Additionally, the widget is automatically added as a dependency in the Alloy project's configuration file config.json.
-->

### アプリケーションをビルドして実行する

App Explorer で Run ボタンをクリックして、実行するプラットフォームを選択してください。ビルドが終わったらアプリケーションが起動します。

<!--
In App Explorer, click the Run button and select the platform to run. Once it finishes building, the application will launch.
-->

### Content Assistance を利用する

Studio 3.1.0 以上では Alloy ファイルに対して Content Assistance をサポートしています。現在、Alloy View XML ファイルの XML タグと属性 (Titanium のプロパティと、 "on" のついた Event)や、TSS ファイルの要素やクラス、ID 属性、 Alloy Controller の JavaScript コードに対して、コード補完を使うことができます。 ID や要素、 class、属性の名前を入力し始めると、候補がポップアップで表示されるはずです。 

<!--
Studio 3.1.0 and later supports content assistance with Alloy files. Currently, code completion is available for the XML tags and attributes (Titanium properties and events with "on") with the Alloy View XML files; element, class and ID attributes for TSS files, and for the JavaScript code with Alloy Controllers. Just start typing a name for an ID, element, class or attribute and a pop-up should appear with suggestions.
-->

Alloy Controller では、関連した View ファイルで定義された id 属性の要素の中でタイプしようとすると、そのオブジェクトに対する assistance が表示されるはずです。たとえば、 markup で以下のようなコードが合った場合、

<!--
For Alloy Controllers, if you type in an element referenced by an id attribute in the associated view file, a pop-up should appear providing assistance for that object. For example, if you have the following defined in markup:
-->

```xml
<Alloy>
    <Window id="win" class="container">
        <Label id="label">Foo</Label>
    </Window>
</Alloy>
```

関連する Controller ファイルで、 ```$.win.``` (末尾のピリオドも含む) を入力すると、 Ti.UI.Window class のプロパティやメソッドがポップアップされ、 ```$.label.``` とタイプすると、 Ti.UI.Label class のプロパティやメソッドがポップアップされます。Assistance を得るには、名前をすべてタイプする必要があります。

<!--
In the associated controller file, if you type $.win. (with the trailing period), properties and methods for a Ti.UI.Window class pop-up, and if you type $.label., properties and methods for a Ti.UI.Label class pop-up. You need to type the entire name to receive assistance.
-->

TSS ファイルでは、 id や class で関連する View ファイルで定義された要素の中でタイプすると、そのオブジェクトに対する assistance がポップアップで表示されるはずです。たとえば、先の markup の例で言うと、関連する TSS ファイルの中で ```".container":{``` とタイプすると Ti.UI.Window class のプロパティがポップアップされ、 ```"#label":{``` とタイプすると Ti.UI.Label class のプロパティがポップアップされます。要素名をタイプすることもできます。Assistance を得るには、要素や class, ID の名前をすべてタイプする必要があります。

<!--
For TSS files, if you type in an element referenced by an id or class attribute in the associated view file, a pop-up should appear providing assistance for that object. For example, using the previous markup example, in the associated TSS file, if you type ".container":{, properties for a Ti.UI.Window class pop-up, and if you type "#label":{, properties for a Ti.UI.Label class pop-up. You can also type the element name. You need to type the entire name of the element, class or ID to receive assistance.
-->

### Alloy のコードをデバッグする

[Alloy デバッグ・トラブルシューティング](Alloy_Debugging_and_Troubleshooting.md) を参照してください。

<!--
Refer to the Alloy Debugging and Troubleshooting guide.
-->